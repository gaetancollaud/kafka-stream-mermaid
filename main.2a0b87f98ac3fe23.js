"use strict";(self.webpackChunkkafka_stream_visualization=self.webpackChunkkafka_stream_visualization||[]).push([[179],{346:(f,S,l)=>{var g=l(427),r=l(551),b=l(499);let T=(()=>{class o{constructor(){this.topology=new b.X(null);let t=window.location.hash;if(t){t.startsWith("#")&&(t=t.substr(1));try{let e=atob(t);this.topology.next(e)}catch(e){console.error("Unable to read topology from url",t,e)}}}clearTopology(){this.topology.next(null),window.location.hash=""}setTopology(t){this.topology.next(t)}getTopology(){return this.topology}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=r.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var C=l(19),v=l(485);const h=o=>o.replaceAll("-","-<br>");let d=(()=>{class o{static startFormatter(t){return`subgraph Sub-Topology: ${t}`}static endFormatter(){return"end"}static visit(t,e,n){let s=t.match(this.pattern);e.length&&e.push(this.endFormatter()),s&&(e.push(this.startFormatter(s[1])),n.push(s[1]))}}return o.pattern=/Sub-topology: ([0-9]*)/,o})(),A=(()=>{class o{static formatter(t,e){return`${e}[${e}] --\x3e ${t}(${h(t)})`}static visit(t,e,n,s){let a=t.match(this.pattern);a&&(s.currentGraphNodeName=a[1].trim(),a[2].split(",").filter(String).map(c=>c.trim()).forEach(c=>{e.push(this.formatter(s.currentGraphNodeName,c)),n.push(c)}))}}return o.pattern=/Source:\s+(\S+)\s+\(topics:\s+\[(.*)\]\)/,o})(),E=(()=>{class o{static formatter(t,e){return t.includes("JOIN")?`${e}[(${h(e)})] --\x3e ${t}(${h(t)})`:`${t}(${h(t)}) --\x3e ${e}[(${h(e)})]`}static visit(t,e,n,s){let a=t.match(this.pattern);a&&(e.currentGraphNodeName=a[1].trim(),a[2].split(",").filter(String).map(c=>c.trim()).forEach(c=>{n.push(this.formatter(e.currentGraphNodeName,c)),s.push(c)}))}}return o.pattern=/Processor:\s+(\S+)\s+\(stores:\s+\[(.*)\]\)/,o})(),y=(()=>{class o{static formatter(t,e){return`${t}(${h(t)}) --\x3e ${e}[${e}]`}static visit(t,e,n,s){let a=t.match(this.pattern);if(a){e.currentGraphNodeName=a[1].trim();let u=a[2].trim();n.push(this.formatter(e.currentGraphNodeName,u)),s.push(u)}}}return o.pattern=/Sink:\s+(\S+)\s+\(topic:\s+(.*)\)/,o})(),R=(()=>{class o{static formatter(t,e){return`${t}(${h(t)}) --\x3e ${e}(${h(e)})`}static visit(t,e,n){let s=t.match(this.pattern);s&&s[1].split(",").filter(String).map(a=>a.trim()).filter(a=>"none"!==a).forEach(a=>{n.push(this.formatter(e.currentGraphNodeName,a))})}}return o.pattern=/\s*-->\s+(.*)/,o})();var K=l(559),O=l(263),w=l(712);const N=["canvas"];let x=(()=>{class o{constructor(t,e){this.sanitizer=t,this.store=e,this.destroySubject=new K.t}ngOnInit(){v.Z.initialize({theme:"default",startOnLoad:!1})}ngAfterViewInit(){this.store.getTopology().pipe((0,O.R)(this.destroySubject),(0,w.b)(300)).subscribe(t=>{if(t){const e=class{static toMermaid(i){let t=i.split("\n"),e=[],n=[],s={currentGraphNodeName:""},a=[],u=[],c=[],m=[];for(const p of t)switch(!0){case d.pattern.test(p):d.visit(p,e,a);break;case A.pattern.test(p):A.visit(p,n,u,s);break;case E.pattern.test(p):E.visit(p,s,n,m);break;case y.pattern.test(p):y.visit(p,s,n,c);break;case R.pattern.test(p):R.visit(p,s,e)}return e.length&&e.push(d.endFormatter()),["graph TD"].concat(n).concat(e).concat(u).concat(c).concat(m).join("\n")}}.toMermaid(t);v.Z.mermaidAPI.render("mermaid-graph-"+Date.now(),e,n=>{this.printSvgToCanvas(n),this.svgContent=n,this.svgContent=this.sanitizer.bypassSecurityTrustHtml(n)})}else this.svgContent=void 0})}ngOnDestroy(){this.destroySubject.next(null),this.destroySubject.complete()}printSvgToCanvas(t){var e;try{let n=window.URL||window.webkitURL||window;if(!n)throw new Error("(browser doesnt support this)");let s=null===(e=this.canvas)||void 0===e?void 0:e.nativeElement,a=s.getContext("2d"),u=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),c=n.createObjectURL(u),m=new Image;m.onload=()=>{s.width=m.width,s.height=m.height,a&&a.drawImage(m,0,0),n.revokeObjectURL(c),console.log("url",s.toDataURL())},m.crossOrigin="Anonymous",m.src=c}catch(n){console.error("Failed to generate canvas")}}}return o.\u0275fac=function(t){return new(t||o)(r.Y36(g.H7),r.Y36(T))},o.\u0275cmp=r.Xpm({type:o,selectors:[["app-kafka-stream-graph"]],viewQuery:function(t,e){if(1&t&&r.Gf(N,5),2&t){let n;r.iGM(n=r.CRH())&&(e.canvas=n.first)}},decls:2,vars:0,consts:[["canvas",""]],template:function(t,e){1&t&&r._UZ(0,"canvas",null,0)},styles:['[_nghost-%COMP%]{display:flex;flex-direction:row}svg[_ngcontent-%COMP%]{resize:none;font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}div[_ngcontent-%COMP%]{text-align:center}canvas[_ngcontent-%COMP%]{margin:auto}']}),o})();function G(o,i){1&o&&r._UZ(0,"textarea",5)}function P(o,i){1&o&&r._UZ(0,"app-kafka-stream-graph")}const M="Topology\nSub-topologies:\nSub-topology: 0\n\tSource:  KSTREAM-SOURCE-0000000000 (topics: [conversation-meta])\n\t--\x3e KSTREAM-TRANSFORM-0000000001\n\tProcessor: KSTREAM-TRANSFORM-0000000001 (stores: [conversation-meta-state])\n\t--\x3e KSTREAM-KEY-SELECT-0000000002\n\t<-- KSTREAM-SOURCE-0000000000\n\tProcessor: KSTREAM-KEY-SELECT-0000000002 (stores: [])\n\t--\x3e KSTREAM-FILTER-0000000005\n\t<-- KSTREAM-TRANSFORM-0000000001\n\tProcessor: KSTREAM-FILTER-0000000005 (stores: [])\n\t--\x3e KSTREAM-SINK-0000000004\n\t<-- KSTREAM-KEY-SELECT-0000000002\n\tSink: KSTREAM-SINK-0000000004 (topic: count-resolved-repartition)\n\t<-- KSTREAM-FILTER-0000000005\nSub-topology: 1\n\tSource: KSTREAM-SOURCE-0000000006 (topics: [count-resolved-repartition])\n\t--\x3e KSTREAM-AGGREGATE-0000000003\n\tProcessor: KSTREAM-AGGREGATE-0000000003 (stores: [count-resolved])\n\t--\x3e KTABLE-TOSTREAM-0000000007\n\t<-- KSTREAM-SOURCE-0000000006\n\tProcessor: KTABLE-TOSTREAM-0000000007 (stores: [])\n\t--\x3e KSTREAM-SINK-0000000008\n\t<-- KSTREAM-AGGREGATE-0000000003\n\tSink: KSTREAM-SINK-0000000008 (topic: streams-count-resolved)\n\t<-- KTABLE-TOSTREAM-0000000007\n\t\t\t";let _=(()=>{class o{constructor(t){this.store=t,this.topologyDefined=!1}ngOnInit(){this.store.getTopology().subscribe(t=>this.topologyDefined=!!t),setTimeout(()=>{this.store.setTopology(M)},10)}onReset(){this.store.clearTopology()}onExample1(){this.store.setTopology(M)}}return o.\u0275fac=function(t){return new(t||o)(r.Y36(T))},o.\u0275cmp=r.Xpm({type:o,selectors:[["app-root"]],decls:10,vars:2,consts:[[1,"actions"],[3,"click"],[1,"content"],["placeholder","Paste your topology here",4,"ngIf"],[4,"ngIf"],["placeholder","Paste your topology here"]],template:function(t,e){1&t&&(r.TgZ(0,"h1"),r._uU(1,"Kafka stream visualization"),r.qZA(),r.TgZ(2,"div",0),r.TgZ(3,"button",1),r.NdJ("click",function(){return e.onReset()}),r._uU(4,"Reset"),r.qZA(),r.TgZ(5,"button",1),r.NdJ("click",function(){return e.onExample1()}),r._uU(6,"Example 1"),r.qZA(),r.qZA(),r.TgZ(7,"div",2),r.YNc(8,G,1,0,"textarea",3),r.YNc(9,P,1,0,"app-kafka-stream-graph",4),r.qZA()),2&t&&(r.xp6(8),r.Q6J("ngIf",!e.topologyDefined),r.xp6(1),r.Q6J("ngIf",e.topologyDefined))},directives:[C.O5,x],styles:["[_nghost-%COMP%]{height:100%;flex:1;display:flex;flex-direction:column;align-items:stretch}[_nghost-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:row}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{flex:1}"]}),o})();var L=l(860);let $=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=r.oAB({type:o,bootstrap:[_]}),o.\u0275inj=r.cJS({providers:[],imports:[[g.b2,L.u5]]}),o})();(0,r.G48)(),g.q6().bootstrapModule($).catch(o=>console.error(o))}},f=>{f.O(0,[736],()=>f(f.s=346)),f.O()}]);